## SRS(001) 정합화 체크리스트: MockExam 제거 + 연속 질문 모드 중심 전환

### 요약

현재 구현은 MOCK_EXAM이 도메인/리얼타임/REST/프론트 전반에 깊게 결합되어 있고, SRS 하단의 “MockExam 제거”와 충돌합니다.
확정된 전략(완전 제거) 기준으로, 아래 체크리스트는 브레이킹 변경 허용 전제로 MockExam 축을 삭제하고 연속 질문 모드로 대체하는 작업 순서입니다.

### 공개 API/인터페이스 변경(브레이킹)

1. PUT /api/modes 요청에서 mode=MOCK_EXAM 제거, mockPlan 제거. 대상:
   backend/presentation/src/main/java/me/go_gradually/omypic/presentation/session/dto/ModeUpdateRequest.java
2. PUT /api/modes 응답에서 mockExamState 제거. 대상:
   backend/presentation/src/main/java/me/go_gradually/omypic/presentation/session/dto/SessionStateResponse.java
3. GET /api/questions/{id}/next 응답에서 mockExamCompleted, mockExamCompletionReason 제거. 대상:
   backend/presentation/src/main/java/me/go_gradually/omypic/presentation/question/dto/NextQuestionResponse.java
4. POST /api/feedback/mock-final 엔드포인트 삭제. 대상:
   backend/presentation/src/main/java/me/go_gradually/omypic/presentation/feedback/controller/FeedbackController.java
5. 프론트 모드 옵션에서 MOCK_EXAM 제거. 대상: frontend/src/shared/constants/models.js

### 구현 체크리스트

1. 문서 정합성

- [x] docs/001 요구사항/SRS.md 상단 모드 설명(즉시/연속/모의고사)을 즉시/연속으로 수정. (완료: 1.2 솔루션 요약 반영)
- [x] docs/005 버그 수정/BUG_FIX_CHECKLIST.md의 MockExam 관련 완료 항목을 “폐기됨” 상태로 갱신. (완료: P0/테스트 항목 폐기 메모 추가)

2. 도메인 계층(MockExam 제거)

- [x] ModeType에서 MOCK_EXAM 삭제. 파일: backend/domain/src/main/java/me/go_gradually/omypic/domain/session/ModeType.java (완료:
  enum 정리)
- [x] MockExamPlan 클래스 삭제. 파일: backend/domain/src/main/java/me/go_gradually/omypic/domain/session/MockExamPlan.java (완료:
  파일 제거)
- [x] SessionState에서 MockExam 상태/메서드(mockExamPlan, isMockExamCompleted, configureMockExam, buildMockFinalFeedbackInput
  등) 제거. (완료: 상태/메서드 정리)
- [x] SessionState.nextQuestion()를 IMMEDIATE/CONTINUOUS 공통 순차 소진 로직으로 단순화. (완료: sequential-only)
- [x] TurnBatchingPolicy에서 MOCK_EXAM_* reason 및 분기 제거. (완료: BatchReason 정리)

3. 애플리케이션 계층

- [x] ModeUpdateCommand의 mockPlan 제거. 파일:
  backend/application/src/main/java/me/go_gradually/omypic/application/session/model/ModeUpdateCommand.java (완료: 필드/내부
  클래스 제거)
- [x] SessionUseCase.updateMode()의 MockExam 구성 분기 제거. (완료: list reset만 유지)
- [x] QuestionUseCase에서 MockExam 완료 플래그 세팅 제거. (완료: next 응답 단순화)
- [x] NextQuestion 모델의 MockExam 필드 제거. 파일:
  backend/application/src/main/java/me/go_gradually/omypic/application/question/model/NextQuestion.java (완료: 필드 제거)
- [x] FeedbackUseCase.generateMockExamFinalFeedback() 제거. (완료: 메서드 삭제)
- [x] RealtimeVoiceUseCase에서 mockTurns 큐, MockExam 전용 배치/최종피드백 분기 제거. (완료: 큐/분기 제거)
- [x] RealtimeVoiceUseCase에서 연속 모드 피드백 TTS 비활성화(SRS: 연속 모드는 텍스트 피드백). (완료: CONTINUOUS에서 streamSpeech 미호출)

4. 프레젠테이션 계층(백엔드)

- [x] ModeController에서 MockExam state 매핑 제거. (완료: 응답 매핑 단순화)
- [x] QuestionController에서 MockExam 응답 필드 매핑 제거. (완료: DTO 필드 제거 반영)
- [x] FeedbackController에서 /mock-final 제거. (완료: 엔드포인트 삭제)
- [x] MockFinalFeedbackRequest DTO 삭제. (완료: 파일 삭제)

5. 프론트엔드(UI/상태/API)

- [x] MODE_OPTIONS에서 MOCK_EXAM 제거. (완료: 모드 탭 정리)
- [x] MOCK_FINAL_MODELS 제거 및 관련 상태(mockFinalModel) 제거. 파일: frontend/src/app/App.jsx (완료: 상태/props 제거)
- [x] useQuestionLists에서 mockOrder, mockCounts, mockFinalRequested, /api/feedback/mock-final 호출 로직 제거. (완료: 훅 단순화)
- [x] buildModePayload()를 {sessionId,mode,continuousBatchSize,selectedGroupTags} 중심으로 전환. 파일:
  frontend/src/shared/utils/mode.js (완료: payload 정리)
- [x] QuestionsOverlay의 모의고사 전용 입력 UI 제거. (완료: 입력 필드 제거)
- [x] ModelSettingsOverlay, SummaryPanel, StatusBar의 “모의고사 최종 모델” 노출 제거. (완료: UI 정리)
- [x] useRealtimeSession의 mockExamCompleted 파생 필드 제거. (완료: question.prompt 정규화 수정)

6. SRS 미구현 갭(결정 고정본)

### 6-1. 질문 리스트 제거 + 질문그룹/태그 중심 전환

- [x] 질문 리스트 도메인/퍼시스턴스/API 제거
- [x] 질문그룹 Aggregate 도입 (`/api/question-groups` 중심)
- [x] 질문그룹:태그를 n:m 구조로 저장 (`tags[]`)
- [x] 질문 항목에 `questionType(nullable)` 필드 추가 (CRUD/UI round-trip)
- [x] 태그 정규화 규칙 적용: `trim + lowercase`
- [x] 태그 통계 단일 API 추가: `GET /api/question-groups/tags/stats`
- [x] 통계 응답 스키마 고정: `[{tag, groupCount, selectable}]`
- [x] 통계 정렬 규칙 고정: `tag` 오름차순
- [x] `groupCount==0`이면 `selectable=false` (계산식 반영, 현재는 파생 태그만 노출되어 0건 태그 미노출)

### 6-2. 모드 설정 계약 변경(listId 제거)

- [x] `PUT /api/modes` 요청에서 `listId` 제거
- [x] `PUT /api/modes` 요청에 `selectedGroupTags(string[])` 필수 추가
- [x] `selectedGroupTags` 빈 배열 요청 시 400 처리
- [x] 무효 태그 포함 시 400 `INVALID_GROUP_TAGS` 처리
- [x] 에러 응답 스키마 고정: `{code,message,invalidTags[]}`

### 6-3. 세션 출제/랜덤 규칙 고정

- [x] 모드 적용 시 `selectedGroupTags` 기준 후보 그룹 계산
- [x] 후보 그룹 순서는 세션 단위 1회 셔플(세션 내 고정)
- [x] 그룹 내부 질문 순서는 등록 순서 유지
- [x] 후보 그룹 없음/전체 소진 시 `NextQuestion.skipped=true`
- [x] 종료 사유는 `QUESTION_EXHAUSTED` 단일 규칙 사용

### 6-4. 연속 모드 배치 단위 전환(질문 -> 그룹)

- [x] `continuousBatchSize` 의미를 “완료된 질문그룹 수”로 재정의
- [x] 배치 카운터를 `answeredQuestionCount`에서 `completedGroupCount`로 전환
- [x] 그룹 완료 판정 규칙 구현: “다음 그룹 진입 또는 질문 소진 시점”
- [x] 질문 소진 시 그룹 잔여 배치 1회 emit 규칙 구현
- [x] realtime `feedback.final.policy`에서 `batchSize` 제거
- [x] realtime `feedback.final.policy`에 `groupBatchSize` 추가
- [x] 프론트 realtime 소비 로직을 `groupBatchSize` 기준으로 교체
- [x] 프론트 문구를 “문항” -> “질문 그룹” 기준으로 교체

### 6-5. 룰북/질문타입 적용 범위 고정

- [x] `questionType`은 질문 CRUD/UI 용도로만 사용
- [x] `RulebookScope`는 기존 `MAIN/QUESTION` 유지
- [x] `QUESTION_TYPE` scope 추가하지 않음
- [x] `searchContextsForTurn`에 questionType 우선선택 로직 추가하지 않음

---

## 7. 테스트 케이스(결정 반영)

### 7-1. 백엔드 단위

- [x] 태그 정규화(`trim+lowercase`) 검증
- [x] 세션 고정 셔플 재현성 검증
- [x] selected tags 외 그룹 미출제 검증
- [x] 후보 그룹 소진 시 `skipped + QUESTION_EXHAUSTED` 검증
- [x] `completedGroupCount` 기준 배치 emit 검증
- [x] 질문 소진 시 잔여 그룹 피드백 emit 검증

### 7-2. 백엔드 통합/컨트롤러

- [x] `PUT /api/modes` 정상 케이스: `selectedGroupTags` 적용 검증
- [x] `PUT /api/modes` 빈 태그: 400 + `INVALID_GROUP_TAGS` 검증
- [x] `PUT /api/modes` 무효 태그: 400 + `invalidTags[]` 검증
- [x] `GET /api/question-groups/tags/stats` 응답 스키마/정렬 검증
- [x] 질문 CRUD/조회/next에서 `questionType` round-trip 검증
- [x] realtime `feedback.final.policy.groupBatchSize` 검증

### 7-3. 프론트

- [x] 리스트 선택 UI 제거 회귀 검증
- [x] 태그 멀티선택 버튼 렌더링(통계 API 기반) 검증
- [x] `selectable=false` 태그 disabled 검증
- [x] 모드 적용 payload에 `selectedGroupTags[]` 포함 검증
- [x] 빈 태그 선택 시 요청 차단/에러 표시 검증
- [x] realtime policy 소비를 `groupBatchSize`로 전환 검증
- [x] 요약/상태 문구가 “질문 그룹” 단위로 표시되는지 검증

### 가정/기본값

1. 태그 선택은 필수이며 전체 자동선택 fallback은 제공하지 않는다.
2. `questionType`은 검색/출제 의사결정에 사용하지 않는다.
3. 태그 카탈로그는 그룹 데이터에서 파생되며 독립 마스터 관리는 없다.
4. 브레이킹 API 변경은 이번 턴에서 허용하며 구버전 호환 계층은 두지 않는다.
