## SRS(001) 정합화 체크리스트: MockExam 제거 + 연속 질문 모드 중심 전환

### 요약

현재 구현은 MOCK_EXAM이 도메인/리얼타임/REST/프론트 전반에 깊게 결합되어 있고, SRS 하단의 “MockExam 제거”와 충돌합니다.
확정된 전략(완전 제거) 기준으로, 아래 체크리스트는 브레이킹 변경 허용 전제로 MockExam 축을 삭제하고 연속 질문 모드로 대체하는 작업 순서입니다.

### 공개 API/인터페이스 변경(브레이킹)

1. PUT /api/modes 요청에서 mode=MOCK_EXAM 제거, mockPlan 제거. 대상:
   backend/presentation/src/main/java/me/go_gradually/omypic/presentation/session/dto/ModeUpdateRequest.java
2. PUT /api/modes 응답에서 mockExamState 제거. 대상:
   backend/presentation/src/main/java/me/go_gradually/omypic/presentation/session/dto/SessionStateResponse.java
3. GET /api/questions/{id}/next 응답에서 mockExamCompleted, mockExamCompletionReason 제거. 대상:
   backend/presentation/src/main/java/me/go_gradually/omypic/presentation/question/dto/NextQuestionResponse.java
4. POST /api/feedback/mock-final 엔드포인트 삭제. 대상:
   backend/presentation/src/main/java/me/go_gradually/omypic/presentation/feedback/controller/FeedbackController.java
5. 프론트 모드 옵션에서 MOCK_EXAM 제거. 대상: frontend/src/shared/constants/models.js

### 구현 체크리스트

1. 문서 정합성

- [x] docs/001 요구사항/SRS.md 상단 모드 설명(즉시/연속/모의고사)을 즉시/연속으로 수정. (완료: 1.2 솔루션 요약 반영)
- [x] docs/005 버그 수정/BUG_FIX_CHECKLIST.md의 MockExam 관련 완료 항목을 “폐기됨” 상태로 갱신. (완료: P0/테스트 항목 폐기 메모 추가)

2. 도메인 계층(MockExam 제거)

- [x] ModeType에서 MOCK_EXAM 삭제. 파일: backend/domain/src/main/java/me/go_gradually/omypic/domain/session/ModeType.java (완료:
  enum 정리)
- [x] MockExamPlan 클래스 삭제. 파일: backend/domain/src/main/java/me/go_gradually/omypic/domain/session/MockExamPlan.java (완료:
  파일 제거)
- [x] SessionState에서 MockExam 상태/메서드(mockExamPlan, isMockExamCompleted, configureMockExam, buildMockFinalFeedbackInput
  등) 제거. (완료: 상태/메서드 정리)
- [x] SessionState.nextQuestion()를 IMMEDIATE/CONTINUOUS 공통 순차 소진 로직으로 단순화. (완료: sequential-only)
- [x] TurnBatchingPolicy에서 MOCK_EXAM_* reason 및 분기 제거. (완료: BatchReason 정리)

3. 애플리케이션 계층

- [x] ModeUpdateCommand의 mockPlan 제거. 파일:
  backend/application/src/main/java/me/go_gradually/omypic/application/session/model/ModeUpdateCommand.java (완료: 필드/내부
  클래스 제거)
- [x] SessionUseCase.updateMode()의 MockExam 구성 분기 제거. (완료: list reset만 유지)
- [x] QuestionUseCase에서 MockExam 완료 플래그 세팅 제거. (완료: next 응답 단순화)
- [x] NextQuestion 모델의 MockExam 필드 제거. 파일:
  backend/application/src/main/java/me/go_gradually/omypic/application/question/model/NextQuestion.java (완료: 필드 제거)
- [x] FeedbackUseCase.generateMockExamFinalFeedback() 제거. (완료: 메서드 삭제)
- [x] RealtimeVoiceUseCase에서 mockTurns 큐, MockExam 전용 배치/최종피드백 분기 제거. (완료: 큐/분기 제거)
- [x] RealtimeVoiceUseCase에서 연속 모드 피드백 TTS 비활성화(SRS: 연속 모드는 텍스트 피드백). (완료: CONTINUOUS에서 streamSpeech 미호출)

4. 프레젠테이션 계층(백엔드)

- [x] ModeController에서 MockExam state 매핑 제거. (완료: 응답 매핑 단순화)
- [x] QuestionController에서 MockExam 응답 필드 매핑 제거. (완료: DTO 필드 제거 반영)
- [x] FeedbackController에서 /mock-final 제거. (완료: 엔드포인트 삭제)
- [x] MockFinalFeedbackRequest DTO 삭제. (완료: 파일 삭제)

5. 프론트엔드(UI/상태/API)

- [x] MODE_OPTIONS에서 MOCK_EXAM 제거. (완료: 모드 탭 정리)
- [x] MOCK_FINAL_MODELS 제거 및 관련 상태(mockFinalModel) 제거. 파일: frontend/src/app/App.jsx (완료: 상태/props 제거)
- [x] useQuestionLists에서 mockOrder, mockCounts, mockFinalRequested, /api/feedback/mock-final 호출 로직 제거. (완료: 훅 단순화)
- [x] buildModePayload()를 {sessionId,listId,mode,batchSize} 중심으로 축소. 파일: frontend/src/shared/utils/mode.js (완료: payload
  정리)
- [x] QuestionsOverlay의 모의고사 전용 입력 UI 제거. (완료: 입력 필드 제거)
- [x] ModelSettingsOverlay, SummaryPanel, StatusBar의 “모의고사 최종 모델” 노출 제거. (완료: UI 정리)
- [x] useRealtimeSession의 mockExamCompleted 파생 필드 제거. (완료: question.prompt 정규화 수정)

6. SRS 주요 미구현 갭(별도 트랙 병행) - 현재 코드 기준 구체화

- [ ] 이번 턴 범위 제외(1~5 우선 구현 완료, 6번은 후속 트랙에서 진행).

현재 기준 코드 근거

- SessionState의 질문 선택은 listIndices 기반 순차 소진이며 태그/랜덤 선택이 없음. 파일:
  backend/domain/src/main/java/me/go_gradually/omypic/domain/session/SessionState.java
- QuestionItem 저장 필드는 text/group만 있고 questionType이 없음. 파일:
  backend/domain/src/main/java/me/go_gradually/omypic/domain/question/QuestionItem.java
- 연속 모드 배치는 질문(답변) 개수 기준으로 pollContinuousTurns(batchSize) 처리 중임. 파일:
  backend/application/src/main/java/me/go_gradually/omypic/application/realtime/usecase/RealtimeVoiceUseCase.java

6-1. 질문 그룹 태그 기반 랜덤 추출

- [ ] 질문 도메인에 그룹-태그 메타 모델 추가(예: QuestionGroupTag, group -> tags 매핑) 및 불변식 정의(빈 태그 금지, 미등록 그룹 금지). 대상:
  backend/domain/src/main/java/me/go_gradually/omypic/domain/question/*
- [ ] Mongo 스키마 확장: QuestionListDocument에 그룹 태그 메타 저장 필드 추가 + 어댑터 양방향 매핑. 대상:
  backend/infrastructure/src/main/java/me/go_gradually/omypic/infrastructure/question/persistence/mongo/*
- [ ] 모드 설정 API 확장: /api/modes 요청에 selectedGroupTags(string[]) 추가. 대상:
  ModeUpdateRequest/ModeUpdateCommand/SessionUseCase
- [ ] SessionState에서 selectedGroupTags 기반 후보 그룹만 추출하고, 그룹 순서는 세션 단위 랜덤 셔플, 그룹 내부 질문 순서는 기존 등록 순서 유지.
- [ ] 후보 그룹이 없거나 모두 소진되면 NextQuestion.skipped=true + 종료 사유 QUESTION_EXHAUSTED로 통일.

6-2. 질문 타입(습관/비교/RP) 모델 필드 및 저장/조회 경로

- [ ] 질문 모델에 questionType 추가(도메인/인프라/프레젠테이션): QuestionItem, QuestionItemDocument, QuestionItemRequest/Response,
  NextQuestion.
- [ ] 질문 CRUD API(create/update/list/next)에서 questionType 입출력 지원(기존 데이터는 null 허용 하위호환).
- [ ] 룰북 모델에 타입 축 추가: RulebookScope에 QUESTION_TYPE 추가, Rulebook/RulebookDocument/RulebookController(upload 파라미터) 반영.
- [ ] 턴 피드백 검색 규칙 확장: questionGroup 1개 + questionType 1개 컨텍스트를 우선 선택(최대 2개)하도록 RulebookUseCase.searchContextsForTurn 조정.
- [ ] 프론트 질문 등록/수정 UI에 questionType 입력/편집/표시 반영. 대상: frontend/src/features/questions/*

6-3. 태그별 그룹 개수 노출 + 없는 태그 비선택

- [ ] 그룹 태그 통계 API 추가: GET /api/questions/{id}/group-tags/stats -> [{tag, groupCount, selectable}].
- [ ] 통계는 "태그별 distinct 질문 그룹 수"로 계산하고, groupCount==0 또는 미등록 태그는 selectable=false 처리.
- [ ] /api/modes에서 selectedGroupTags 유효성 검증 추가(존재하지 않거나 selectable=false 태그 포함 시 400 INVALID_GROUP_TAGS).
- [ ] 프론트 모드 패널에 태그 목록/카운트 표시 및 0개 태그 비활성화(disabled) 반영. 대상: QuestionsOverlay/useQuestionLists
- [ ] 태그 미선택 시 기본 정책을 "전체 그룹 대상 랜덤 추출"로 명시하고 백엔드 기본값으로 강제.

6-4. 연속 모드 n 단위를 질문 수 -> 질문 그룹 수로 재정의

- [ ] continuousBatchSize 의미를 "피드백 주기(질문 그룹 수)"로 재정의하고 API 필드명은 하위호환을 위해 유지.
- [ ] RealtimeVoiceUseCase의 연속 큐를 질문 단위에서 그룹 단위 배치로 변경(동일 group의 문답 묶음을 1그룹으로 적재).
- [ ] 그룹 완료 판정 규칙 구현: 다음 질문의 group 변경 시점 또는 질문 소진 시점에 현재 그룹 완료 처리.
- [ ] TurnBatchingPolicy 입력 카운터를 answeredQuestionCount가 아니라 completedGroupCount로 전환.
- [ ] feedback.final payload policy에 batchUnit=GROUP 추가(프론트에서 단위 오해 방지).
- [ ] 프론트 라벨/요약 문구를 "문항"이 아닌 "질문 그룹" 기준으로 변경. 대상: frontend/src/shared/constants/models.js

### 테스트 케이스/시나리오

1. 백엔드 단위

- [x] ModeType 직렬화/역직렬화에서 MOCK_EXAM 입력 시 4xx 처리 검증. (완료: ModeControllerTest 추가)
- [x] TurnBatchingPolicy: IMMEDIATE 즉시 emit, CONTINUOUS 배치 emit + 소진 잔여 emit 검증. (완료: TurnBatchingPolicyTest 추가)
- [x] SessionState.nextQuestion: 리스트 소진 시 skipped 처리 검증. (완료: SessionStateTest 유지)

2. 백엔드 통합/컨트롤러

- [x] POST /api/feedback/mock-final 404 또는 제거 검증. (완료: FeedbackControllerTest 추가)
- [x] /api/modes 응답에 mockExamState 미포함 검증. (완료: ModeControllerTest 응답 검증)
- [x] /api/questions/{id}/next 응답에 mock 관련 필드 미포함 검증. (완료: QuestionControllerTest 응답 검증)
- [ ] 리얼타임 feedback.final 이벤트: CONTINUOUS 모드에서 TTS 청크 미발행 검증.

3. 프론트

- [x] 모드 탭에 즉시/연속만 노출. (완료: MODE_OPTIONS 수정)
- [x] 모드 적용 payload에 mockPlan 미포함. (완료: frontend mode.test 반영)
- [x] 질문 소진 시 상태 문구가 일반 소진 문구로 일원화. (완료: getCurrentQuestionLabel 정리)
- [x] 설정 패널/상태바에서 mock final model 표시 제거. (완료: SummaryPanel/StatusBar 반영)
- [x] 기존 mode.test.js의 mock 관련 테스트 제거 후 연속 모드 케이스로 대체. (완료: mode.test.js 교체)

4. SRS 미구현 갭 전용(추가)

- [ ] SessionState 태그 랜덤 선택: selectedGroupTags 외 그룹 미선택, 그룹 중복 소진 없음 검증.
- [ ] selectedGroupTags가 비어있을 때 전체 그룹 랜덤 추출 기본값 검증.
- [ ] selectedGroupTags가 모두 무효일 때 skipped + QUESTION_EXHAUSTED 검증.
- [ ] 질문 CRUD/조회/next 응답에서 questionType round-trip 저장/복원 검증.
- [ ] RulebookUseCase.searchContextsForTurn: questionGroup/questionType 각각 최대 1개 우선 선택 검증.
- [ ] group-tags/stats API: 태그별 groupCount/selectable 계산 및 정렬 검증.
- [ ] CONTINUOUS 모드 배치: n개의 질문이 아니라 n개의 질문 그룹 완료 시 feedback.final emit 검증.

### 가정/기본값

1. MockExam은 완전 삭제하며 하위호환을 제공하지 않는다.
2. 연속 질문 모드가 MockExam의 대체 플로우이며, 별도 “최종 피드백” REST 엔드포인트는 두지 않는다.
3. 질문 소진 종료 사유는 QUESTION_EXHAUSTED 단일 규칙으로 통합한다.
4. 연속 모드 피드백은 텍스트만 제공하고 음성(TTS)은 제공하지 않는다(SRS 우선).
