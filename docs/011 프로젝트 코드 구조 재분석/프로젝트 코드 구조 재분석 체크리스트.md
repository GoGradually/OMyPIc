# LLM 동작 방식

0. 백엔드는 세션 시작 시, LLM에게 초기 부트스트랩용 시스템 프롬프트를 전달하여, 해당 세션에서 사용할 LLM의 행동 지침을 전달한다.

1. 백엔드는 TTS 모델에게 텍스트(질문)를 TTS로 변환해달라고 요청함과 동시에, 해당 질문에 적절한 룰북 문서를 벡터 임베딩으로 검색하여 찾아둔다.
2. 백엔드는 사용자의 응답 메시지(오디오)를 STT 모델에게 텍스트로 변환해달라고 요청하여, 해당 텍스트를 받는다.
3. 백엔드는 사용자에게 전달한 질문(텍스트) + 1번에서 찾아둔 룰북 문서와 2번에서 받은 텍스트를 바탕으로, LLM에게 피드백을 생성해달라고 요청한다.
4. LLM은 해당 질문과 룰북 문서, 그리고 사용자의 응답 텍스트를 바탕으로, 피드백을 생성하여 반환한다.
5. 백엔드는 해당 피드백을 프론트로 반환한다.
6. 프론트는 반환된 피드백을 사용자에게 표시한다.

# TTS 동작 방식

1. 백엔드는 모델에게 텍스트(질문)를 TTS로 변환해달라고 요청한다.
2. 모델이 텍스트를 받아, 음성으로 변환하여 반환한다.
2. 백엔드는 해당 음성 파일을 프론트로 반환한다.
3. 프론트는 반환된 음성 파일을 재생한다.

# STT 동작 방식

1. 오디오를 입력받는다.
2. 사용자가 3초 이상 침묵하면, 응답이 종료된 것으로 간주한다.
3. 응답이 종료되면, 프론트는 사용자-프론트 사이의 오디오 파이프를 닫고, 해당 오디오를 피드백해달라는 요청을 백엔드에 보낸다.
4. 백엔드는 모델에게 해당 음성 파일을 텍스트로 변환해달라고 요청한다.
4. 모델은 해당 음성 파일을 받아, 텍스트로 변환하여 반환한다.



# 음성 이벤트 복구
1. 음성 이벤트 연결이 끊겼을 때, 세션은 현재 사용하던 세션을 임시로 저장해둔다.
2. 프로그램은 음성 이벤트 복구를 시도한다.
3. 음성 이벤트가 복구되면, 다시 기존 세션으로 돌아가 저장된 기존 응답을 가져온다.
4. 그 후, 음성 이벤트를 다시 받기 위한 READY 상태로 돌아간다.
5. 사용자가 다시 응답을 시작하면, 사용자의 해당 음성 응답을 계속 기록하고, 기존에 저장된 사용자 응답 데이터 뒤에 덧붙여서 음성 데이터 연결을 완성한다.
6. 이는 반복된 음성 이벤트 끊김에도 강건하게 동작해야 한다.
