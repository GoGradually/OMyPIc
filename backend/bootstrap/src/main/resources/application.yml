server:
  port: 4317
  shutdown: graceful

spring:
  application:
    name: omypic-backend
  data:
    mongodb:
      uri: ${OMYPIC_MONGODB_URI:mongodb://localhost:27017/omypic}

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  metrics:
    distribution:
      percentiles-histogram:
        stt.latency: true
        feedback.latency: true
        tts.latency: true
        question.next.latency: true
        voice.turn.latency: true
        rulebook.upload.latency: true

omypic:
  data-dir: ${OMYPIC_DATA_DIR:${user.home}/OMyPIc}
  stt:
    max-file-bytes: 26214400
    max-duration-seconds: 180
    retry-max: 2
    vad:
      prefix-padding-ms: 300
      silence-duration-ms: 200
      threshold: 0.5
  rag:
    provider: ${OMYPIC_RAG_PROVIDER:fasttext}
    embedding-dim: 300
    max-context-chunks: 4
    model-path: ${OMYPIC_RAG_MODEL_PATH:}
    model-version: ${OMYPIC_RAG_MODEL_VERSION:cc.ko.300.vec.gz}
    model-sha256: ${OMYPIC_RAG_MODEL_SHA256:9d71f0ae144e0f89dd233bfa7eca421be26bd1e5dd18e2cc56888a04be982d97}
    download-url: ${OMYPIC_RAG_DOWNLOAD_URL:https://dl.fbaipublicfiles.com/fasttext/vectors-crawl/cc.ko.300.vec.gz}
    download-timeout-seconds: 1800
    download-retry-max: 2
    allow-hash-fallback: ${OMYPIC_RAG_ALLOW_HASH_FALLBACK:false}
    model-max-vocab: 200000
  feedback:
    summary-max-chars: 400
    example-min-ratio: 0.8
    example-max-ratio: 1.2
    wrongnote-summary-max-chars: 255
    wrongnote-window-size: 100
  voice:
    stt-model: gpt-4o-mini-transcribe
    feedback-model: gpt-4o-mini
    feedback-language: ko
    tts-model: gpt-4o-mini-tts
    tts-voice: alloy
    silence-duration-ms: 1500
  integrations:
    openai:
      base-url: ${OMYPIC_OPENAI_BASE_URL:https://api.openai.com}
